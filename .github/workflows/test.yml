name: Test

on:
  push:
    paths: .github/workflows/test.yml

jobs:

  build:
    name: Build
    runs-on: windows-2022
    steps:
    
    - name: Setup VS Dev Environment
      uses: seanmiddleditch/gha-setup-vsdevenv@v4
      with:
        components: Microsoft.VisualStudio.Workload.NativeDesktop; Microsoft.VisualStudio.Component.Windows10SDK.19041; Microsoft.VisualStudio.Component.VC.ATL.Spectre

    - name: Clone mozillabuild
      run: |
        curl https://cdn.dothq.co/artifacts/tools/mozilla-build.zip -o mozilla-build.zip
        ls
        7z x mozilla-build.zip -aoa -oC:\mozilla-build 

    - name: Checkout
      uses: actions/checkout@v3.0.0
      with:
        repository: theoware/Firefox

    - name: Run in MozillaBuild
      uses: dothq/mozillabuild-shell-action@1f3c7a98e3e32c336d720e38dd592406397db1f7
      with:
        run: mach build

    - run: dir.exe /s
      if: always()
