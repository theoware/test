name: Wine GE custom

on:
  push:
    paths: .github/workflows/wine-ge-custom.yml
  workflow_dispatch:

jobs:
  build-wine-ge:
    runs-on: ubuntu-18.04
    env:
      RELEASE_VERSION: 7.11
    steps:

    - name: Checkout
      uses: actions/checkout@v3.0.2
      with:
        repository: GloriousEggroll/wine-ge-custom
        submodules: recursive

    - name: Install dependencies
      working-directory: ./buildbot
      run: |
        echo "IyEvYmluL2Jhc2gKCnRyYXAgVHJhcENsZWFuIEVSUiBJTlQKCnJvb3RfZGlyPSIkKGNkICIkKGRpcm5hbWUgIiR7QkFTSF9TT1VSQ0VbMF19IikiICYmIHB3ZCkiCmNkICR7cm9vdF9kaXJ9CgpsaWJfcGF0aD0iLi4vLi4vbGliLyIKcnVudGltZV9wYXRoPSQocmVhZGxpbmsgLWYgIi4uLy4uL3J1bnRpbWUvZXh0cmEvIikKc291cmNlICR7bGliX3BhdGh9cGF0aC5zaApzb3VyY2UgJHtsaWJfcGF0aH11dGlsLnNoCnNvdXJjZSAke2xpYl9wYXRofXVwbG9hZF9oYW5kbGVyLnNoCgpidWlsZGJvdDMyaG9zdD0iYnVpbGRib3QzMiIKYnVpbGRib3Q2NGhvc3Q9ImJ1aWxkYm90NjQiCnJ1bm5lcl9uYW1lPSQoZ2V0X3J1bm5lcikKc291cmNlX2Rpcj0iJHtyb290X2Rpcn0vJHtydW5uZXJfbmFtZX0tc3JjIgpidWlsZF9kaXI9IiR7cm9vdF9kaXJ9LyR7cnVubmVyX25hbWV9IgphcmNoPSQodW5hbWUgLW0pCnZlcnNpb249IjUuMCIKY29uZmlndXJlX29wdHM9Ii0tZGlzYWJsZS10ZXN0cyAtLXdpdGgteCAtLXdpdGgtZ3N0cmVhbWVyIgoKcGFyYW1zPSQoZ2V0b3B0IC1uICQwIC1vIGE6Yjp3OnY6cDpzbmQ2a2ZjbXQgLS1sb25nIGFzOixicmFuY2g6LHdpdGg6LHZlcnNpb246LHBhdGNoOixzdGFnaW5nLG5vdXBsb2FkLGRlcGVuZGVuY2llcyw2NGJpdCxrZWVwLGtlZXAtdXBsb2FkLWZpbGUsdXNlY2NhY2hlLHVzZW1pbmd3LG5vc3RyaXAgLS0gIiRAIikKZXZhbCBzZXQgLS0gJHBhcmFtcwp3aGlsZSB0cnVlIDsgZG8KICAgIGNhc2UgIiQxIiBpbgogICAgICAgIC1hfC0tYXMpIGJ1aWxkX25hbWU9JDI7IHNoaWZ0IDIgOzsKICAgICAgICAtYnwtLWJyYW5jaCkgYnJhbmNoX25hbWU9JDI7IHNoaWZ0IDIgOzsKICAgICAgICAtd3wtLXdpdGgpIHJlcG9fdXJsPSQyOyBzaGlmdCAyIDs7CiAgICAgICAgLXZ8LS12ZXJzaW9uKSB2ZXJzaW9uPSQyOyBzaGlmdCAyIDs7CiAgICAgICAgLXB8LS1wYXRjaCkgcGF0Y2g9JDI7IHNoaWZ0IDIgOzsKICAgICAgICAtc3wtLXN0YWdpbmcpIFNUQUdJTkc9MTsgc2hpZnQgOzsKICAgICAgICAtbnwtLW5vdXBsb2FkKSBOT1VQTE9BRD0xOyBzaGlmdCA7OwogICAgICAgIC1kfC0tZGVwZW5kZW5jaWVzKSBJTlNUQUxMX0RFUFM9MTsgc2hpZnQgOzsKICAgICAgICAtNnwtLTY0Yml0KSBXT1c2ND0xOyBzaGlmdCA7OwogICAgICAgIC1rfC0ta2VlcCkgS0VFUD0xOyBzaGlmdCA7OwogICAgICAgIC1mfC0ta2VlcC11cGxvYWQtZmlsZSkgS0VFUF9VUExPQURfRklMRT0xOyBzaGlmdCA7OwogICAgICAgIC1jfC0tdXNlY2NhY2hlKSBDQ0FDSEU9MTsgc2hpZnQgOzsKICAgICAgICAtbXwtLXVzZW1pbmd3KSBNSU5HVz0xOyBzaGlmdCA7OwogICAgICAgIC10fC0tbm9zdHJpcCkgTk9TVFJJUD0xOyBzaGlmdCA7OwogICAgICAgICopIHNoaWZ0OyBicmVhayA7OwogICAgZXNhYwpkb25lCgppZiBbICIkYnVpbGRfbmFtZSIgXTsgdGhlbgogICAgZmlsZW5hbWVfb3B0cz0iJHtidWlsZF9uYW1lfS0iCmVsaWYgWyAiJFNUQUdJTkciIF07IHRoZW4KICAgIGZpbGVuYW1lX29wdHM9InN0YWdpbmctIgpmaQoKaWYgWyAiJFdPVzY0IiBdOyB0aGVuCiAgICAjIENoYW5nZSBhcmNoIG5hbWUsIHRoaXMgaXMgdXNlZCBpbiB0aGUgZmluYWwgZmlsZSBuYW1lIGFuZCB3ZSB3YW50IHRoZQogICAgIyB4ODZfNjQgcGFydCBldmVuIG9uIHRoZSAzMmJpdCBjb250YWluZXIgZm9yIFdPVzY0LgogICAgYXJjaD0ieDg2XzY0IgpmaQoKYmluX2Rpcj0iJHtmaWxlbmFtZV9vcHRzfSR7dmVyc2lvbn0tJHthcmNofSIKd2luZTMyX2FyY2hpdmU9IiR7YmluX2Rpcn0tMzJiaXQudGFyLmd6IgpkZXN0X2ZpbGU9IiR7YmluX2Rpcn0tYnVpbGQudGFyLmd6Igp1cGxvYWRfZmlsZT0id2luZS0ke2ZpbGVuYW1lX29wdHN9JHt2ZXJzaW9ufS0ke2FyY2h9LnRhci54eiIKCkJ1aWxkV2luZSgpIHsKICAgIHRyYXAgVHJhcENsZWFuIEVSUiBJTlQKICAgIHByZWZpeD0ke3Jvb3RfZGlyfS8ke2Jpbl9kaXJ9CiAgICBta2RpciAtcCAkYnVpbGRfZGlyCiAgICBjZCAkYnVpbGRfZGlyCgogICAgIyBEbyBub3QgdXNlICRhcmNoIGhlcmUgc2luY2UgaXQgbWlndGggaGF2ZSBiZWVuIGNoYW5nZWQgZm9yIHRoZSBXT1c2NAogICAgIyBidWlsZCBvbiB0aGUgMzJiaXQgY29udGFpbmVyCiAgICBpZiBbICIkKHVuYW1lIC1tKSIgPSAieDg2XzY0IiBdOyB0aGVuCiAgICAgICAgY29uZmlndXJlX29wdHM9IiRjb25maWd1cmVfb3B0cyAtLWVuYWJsZS13aW42NCAtLWxpYmRpcj0kcHJlZml4L2xpYjY0IgogICAgZmkKCiAgICAjIFRoaXJkIHN0ZXAgdG8gc3RpdGNoIHRvZ2V0aGVyIFdpbmU2NCBhbmQgV2luZTMyIGJ1aWxkIGZvciB0aGUgV09XNjQgYnVpbGQKICAgIGlmIFsgIiQxIiA9ICJjb21ibyIgXTsgdGhlbgogICAgICAgIGNvbmZpZ3VyZV9vcHRzPSIkY29uZmlndXJlX29wdHMgLS13aXRoLXdpbmU2ND0uLi93aW5lNjQgLS13aXRoLXdpbmUtdG9vbHM9Li4vd2luZTMyIC0tbGliZGlyPSRwcmVmaXgvbGliIgogICAgZmkKCiAgICBpZiBbICIkKHVuYW1lIC1tKSIgPSAieDg2XzY0IiBdOyB0aGVuCiAgICAgICAgZXhwb3J0IExEX0xJQlJBUllfUEFUSD0ke3J1bnRpbWVfcGF0aH0vbGliNjQKICAgICAgICBjdXN0b21fbGRfZmxhZ3M9Ii1MJHtydW50aW1lX3BhdGh9L2xpYjY0IC1XbCwtcnBhdGgtbGluaywke3J1bnRpbWVfcGF0aH0vbGliNjQiCiAgICBlbHNlCiAgICAgICAgZXhwb3J0IExEX0xJQlJBUllfUEFUSD0ke3J1bnRpbWVfcGF0aH0vbGliMzIKICAgICAgICBjdXN0b21fbGRfZmxhZ3M9Ii1MJHtydW50aW1lX3BhdGh9L2xpYjMyIC1XbCwtcnBhdGgtbGluaywkcnVudGltZV9wYXRoL2xpYjMyIgogICAgZmkKCiAgICBpZiBbICRDQ0FDSEUgXTsgdGhlbgogICAgICAgIGV4cG9ydCBDQz0iY2NhY2hlIGdjYyIKICAgICAgICAgICAgaWYgWyAiJCh1bmFtZSAtbSkiID0gIng4Nl82NCIgXTsgdGhlbgogICAgICAgICAgICAgICAgZXhwb3J0IENST1NTQ0M9ImNjYWNoZSB4ODZfNjQtdzY0LW1pbmd3MzItZ2NjIgogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBleHBvcnQgQ1JPU1NDQz0iY2NhY2hlIGk2ODYtdzY0LW1pbmd3MzItZ2NjIgogICAgICAgICAgICBmaQogICAgICAgIGVsc2UKICAgICAgICBleHBvcnQgQ0M9ImdjYyIKICAgICAgICAgICAgaWYgWyAiJCh1bmFtZSAtbSkiID0gIng4Nl82NCIgXTsgdGhlbgogICAgICAgICAgICAgICAgZXhwb3J0IENST1NTQ0M9Ing4Nl82NC13NjQtbWluZ3czMi1nY2MiCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGV4cG9ydCBDUk9TU0NDPSJpNjg2LXc2NC1taW5ndzMyLWdjYyIKICAgICAgICAgICAgZmkKICAgIGZpCgogICAgaWYgWyAkTUlOR1cgXTsgdGhlbgogICAgICAgIE1JTkdXX1NUQVRFPSItLXdpdGgtbWluZ3ciCiAgICAgICAgZWxzZQogICAgICAgIE1JTkdXX1NUQVRFPSItLXdpdGhvdXQtbWluZ3ciCiAgICBmaQoKICAgIExERkxBR1M9IiRjdXN0b21fbGRfZmxhZ3MiICRzb3VyY2VfZGlyL2NvbmZpZ3VyZSAke2NvbmZpZ3VyZV9vcHRzfSAtLXByZWZpeD0kcHJlZml4ICRNSU5HV19TVEFURQogICAgbWFrZSAtaiQoZ2V0Y29uZiBfTlBST0NFU1NPUlNfT05MTikKICAgIAp9CgpCdWlsZEZpbmFsV293NjRCdWlsZCgpIHsKICAgIHRyYXAgVHJhcENsZWFuIEVSUiBJTlQKICAgIGNkICR7cm9vdF9kaXJ9CiAgICAjIEV4dHJhY3QgdGhlIHdpbmUgYnVpbGQgcmVjZWl2ZWQgZnJvbSB0aGUgMzJiaXQgY29udGFpbmVyCiAgICB0YXIgeHpmICR3aW5lMzJfYXJjaGl2ZQogICAgY2QgJGJ1aWxkX2RpcgogICAgbWFrZSBpbnN0YWxsCn0KClNlbmQ2NEJpdEJ1aWxkQW5kQnVpbGQzMmJpdCgpIHsKICAgIHRyYXAgVHJhcENsZWFuIEVSUiBJTlQKICAgICMgQnVpbGQgdGhlIDY0Yml0IHZlcnNpb24gb2Ygd2luZSwgc2VuZCBpdCB0byB0aGUgMzJiaXQgY29udGFpbmVyIHRoZW4gZXhpdAogICAgY2QgJHtyb290X2Rpcn0KCiAgICAjIFBhY2thZ2UgdGhlIDY0Yml0IGJ1aWxkIChpbiBhIHdpbmU2NCBmb2xkZXIpCiAgICBlY2hvICJTZW5kaW5nIHRoZSA2NGJpdCBidWlsZCB0byB0aGUgMzJiaXQgY29udGFpbmVyIgogICAgbXYgd2luZSB3aW5lNjQKICAgIHRhciBjemYgJHtkZXN0X2ZpbGV9IHdpbmU2NAogICAgc2NwICR7ZGVzdF9maWxlfSAke2J1aWxkYm90MzJob3N0fToke3Jvb3RfZGlyfQogICAgbXYgd2luZTY0IHdpbmUKICAgIHJtICR7ZGVzdF9maWxlfQoKICAgIGVjaG8gIkJ1aWxkaW5nIDMyYml0IHdpbmUiCiAgICBvcHRzPSIiCiAgICBpZiBbICRTVEFHSU5HIF07IHRoZW4KICAgICAgICBvcHRzPSItLXN0YWdpbmciCiAgICBmaQogICAgaWYgWyAkS0VFUCBdOyB0aGVuCiAgICAgICAgb3B0cz0iJHtvcHRzfSAtLWtlZXAiCiAgICBmaQogICAgaWYgWyAkS0VFUF9VUExPQURfRklMRSBdOyB0aGVuCiAgICAgICAgb3B0cz0iJHtvcHRzfSAtLWtlZXAtdXBsb2FkLWZpbGUiCiAgICBmaQogICAgaWYgWyAkTk9VUExPQUQgXTsgdGhlbgogICAgICAgIG9wdHM9IiR7b3B0c30gLS1ub3VwbG9hZCIKICAgIGZpCiAgICBpZiBbICRJTlNUQUxMX0RFUFMgXTsgdGhlbgogICAgICAgIG9wdHM9IiR7b3B0c30gLS1kZXBlbmRlbmNpZXMiCiAgICBmaQogICAgaWYgWyAkcGF0Y2ggXTsgdGhlbgogICAgICAgIG9wdHM9IiR7b3B0c30gLS1wYXRjaCAkcGF0Y2giCiAgICBmaQogICAgaWYgWyAkYnVpbGRfbmFtZSBdOyB0aGVuCiAgICAgICAgb3B0cz0iJHtvcHRzfSAtLWFzICRidWlsZF9uYW1lIgogICAgZmkKICAgIGlmIFsgJHJlcG9fdXJsIF07IHRoZW4KICAgICAgICBvcHRzPSIke29wdHN9IC0td2l0aCAkcmVwb191cmwiCiAgICBmaQogICAgaWYgWyAiJGJyYW5jaF9uYW1lIiBdOyB0aGVuCiAgICAgICAgb3B0cz0iJHtvcHRzfSAtLWJyYW5jaCAkYnJhbmNoX25hbWUiCiAgICBmaQogICAgaWYgWyAiJENDQUNIRSIgXTsgdGhlbgogICAgICAgIG9wdHM9IiR7b3B0c30gLS11c2VjY2FjaGUiCiAgICBmaQogICAgaWYgWyAiJE1JTkdXIiBdOyB0aGVuCiAgICAgICAgb3B0cz0iJHtvcHRzfSAtLXVzZW1pbmd3IgogICAgZmkKICAgIGlmIFsgIiROT1NUUklQIiBdOyB0aGVuCiAgICAgICAgb3B0cz0iJHtvcHRzfSAtLW5vc3RyaXAiCiAgICBmaQoKICAgIGVjaG8gIkJ1aWxkaW5nIDMyYml0IHdpbmUgb24gMzJiaXQgY29udGFpbmVyIgogICAgc3NoIC10ICR7YnVpbGRib3QzMmhvc3R9ICIke3Jvb3RfZGlyfS9idWlsZC5zaCAtdiAke3ZlcnNpb259ICR7b3B0c30gLS02NGJpdCIKICAgIGVjaG8gIlJlbGF1bmNoIGxvY2FsIGJ1aWxkIGFmdGVyIHRoZSAzMmJpdCBidWlsZCBmaW5pc2hlZCIKICAgIC4vYnVpbGQuc2ggLXYgJHt2ZXJzaW9ufSAke29wdHN9CiAgICBlY2hvICJCdWlsZCByZWxhdW5jaGVkIgp9CgpDb21iaW5lNjRhbmQzMmJpdEJ1aWxkcygpIHsKICAgIHRyYXAgVHJhcENsZWFuIEVSUiBJTlQKICAgIGNkICR7cm9vdF9kaXJ9CiAgICAjIEV4dHJhY3QgdGhlIDY0Yml0IGJ1aWxkIG9mIFdpbmUgcmVjZWl2ZWQgZnJvbSB0aGUgYnVpbGRib3Q2NCBjb250YWluZXIKICAgIHdpbmU2NGJ1aWxkX2FyY2hpdmU9IiR7ZmlsZW5hbWVfb3B0c30ke3ZlcnNpb259LXg4Nl82NC1idWlsZC50YXIuZ3oiCiAgICBpZiBbICEgLWYgJHdpbmU2NGJ1aWxkX2FyY2hpdmUgXTsgdGhlbgogICAgICAgIGVjaG8gIk1pc3Npbmcgd2luZTY0IGJ1aWxkIGZpbGUgJHdpbmU2NGJ1aWxkX2FyY2hpdmUiCiAgICAgICAgZXhpdCAyCiAgICBmaQogICAgdGFyIHh6ZiAiJHdpbmU2NGJ1aWxkX2FyY2hpdmUiCgogICAgIyBSZW5hbWUgdGhlIDMyYml0IGJ1aWxkIG9mIHdpbmUKICAgIG12IHdpbmUgd2luZTMyCgogICAgIyBCdWlsZCB0aGUgY29tYmluZWQgV2luZTMyICsgV2luZTY0CiAgICBCdWlsZFdpbmUgY29tYm8KICAgIG1ha2UgaW5zdGFsbAoKICAgIGNkICR7cm9vdF9kaXJ9CiAgICAjIFBhY2thZ2UgYW5kIHNlbmQgdGhlIGJ1aWxkIHRvIHRoZSA2NGJpdCBjb250YWluZXIKICAgIHRhciBjemYgJHt3aW5lMzJfYXJjaGl2ZX0gJHtiaW5fZGlyfQogICAgc2NwICR7d2luZTMyX2FyY2hpdmV9ICR7YnVpbGRib3Q2NGhvc3R9OiR7cm9vdF9kaXJ9CiAgICBpZiBbICEgJEtFRVAgXTsgdGhlbgogICAgICAgIHJtIC1yZiAke2J1aWxkX2Rpcn0gJHt3aW5lMzJfYXJjaGl2ZX0gJHt3aW5lNjRidWlsZF9hcmNoaXZlfSB3aW5lMzIgd2luZTY0ICR7YmluX2Rpcn0KICAgIGZpCn0KCkJ1aWxkKCkgewogICAgdHJhcCBUcmFwQ2xlYW4gRVJSIElOVAogICAgaWYgWyAtZiAke3dpbmUzMl9hcmNoaXZlfSBdOyB0aGVuCiAgICAgICAgIyBUaGUgNjRiaXQgY29udGFpbmVyIGhhcyByZWNlaXZlZCB0aGUgMzJiaXQgYnVpbGQKICAgICAgICBCdWlsZEZpbmFsV293NjRCdWlsZAogICAgZWxzZQogICAgCiAgICAgICAgQnVpbGRXaW5lCgogICAgICAgIGlmIFsgIiQodW5hbWUgLW0pIiA9ICJ4ODZfNjQiIF07IHRoZW4KICAgICAgICAgICAgIyBTZW5kIHRoZSBidWlsZCB0byB0aGUgMzJiaXQgY29udGFpbmVyCiAgICAgICAgICAgIFNlbmQ2NEJpdEJ1aWxkQW5kQnVpbGQzMmJpdAogICAgICAgICAgICBleGl0CiAgICAgICAgZmkKCiAgICAgICAgaWYgWyAiJFdPVzY0IiBdOyB0aGVuCiAgICAgICAgICAgICMgT24gYSAzMmJpdCBjb250YWluZXIsIGJ1aWxkIHdpbmUgdGhlbiBzZW5kIGl0IGJhY2sgdG8gdGhlIDY0Yml0CiAgICAgICAgICAgICMgY29udGFpbmVyCiAgICAgICAgICAgIENvbWJpbmU2NGFuZDMyYml0QnVpbGRzCiAgICAgICAgICAgIGV4aXQKICAgICAgICBmaQoKICAgICAgICBlY2hvICJSdW5uaW5nIG1ha2UgaW5zdGFsbCIKICAgICAgICBtYWtlIGluc3RhbGwKICAgIGZpCn0KClBhY2thZ2UoKSB7CiAgICB0cmFwIFRyYXBDbGVhbiBFUlIgSU5UCiAgICBjZCAke3Jvb3RfZGlyfQoKICAgICMgQ2xlYW4gdXAgd2luZSBidWlsZAogICAgaWYgWyAhICROT1NUUklQIF07IHRoZW4KICAgICAgICBmaW5kICR7YmluX2Rpcn0vYmluIC10eXBlIGYgLWV4ZWMgc3RyaXAge30gXDsKICAgICAgICBmb3IgX2YgaW4gIiRiaW5fZGlyIi97YmluLGxpYixsaWI2NH0ve3dpbmUvKiwqfTsgZG8KICAgICAgICAgICAgaWYgW1sgIiRfZiIgPSAqLnNvIF1dIHx8IFtbICIkX2YiID0gKi5kbGwgXV07IHRoZW4KICAgICAgICAgICAgICAgIHN0cmlwIC0tc3RyaXAtdW5uZWVkZWQgIiRfZiIgfHwgdHJ1ZQogICAgICAgICAgICBmaQogICAgICAgIGRvbmUKICAgICAgICBmb3IgX2YgaW4gIiRiaW5fZGlyIi97YmluLGxpYixsaWI2NH0ve3dpbmUve3g4Nl82NC11bml4LHg4Nl82NC13aW5kb3dzLGkzODYtdW5peCxpMzg2LXdpbmRvd3N9LyosKn07IGRvCiAgICAgICAgICAgIGlmIFtbICIkX2YiID0gKi5zbyBdXSB8fCBbWyAiJF9mIiA9ICouZGxsIF1dOyB0aGVuCiAgICAgICAgICAgICAgICBzdHJpcCAtLXN0cmlwLXVubmVlZGVkICIkX2YiIHx8IHRydWUKICAgICAgICAgICAgZmkKICAgICAgICBkb25lCiAgICBmaQoKICAgICNjb3B5IHNkbDIsIGZhdWRpbywgdmtkM2QsIGFuZCBmZm1wZWcgbGlicmFyaWVzCiAgICBjcCAtUiAkcnVudGltZV9wYXRoL2xpYjMyLyogJHtiaW5fZGlyfS9saWIvCgogICAgaWYgWyAiJCh1bmFtZSAtbSkiID0gIng4Nl82NCIgXTsgdGhlbgogICAgICAgIG1rZGlyIC1wICR7YmluX2Rpcn0vbGliNjQvCiAgICAgICAgY3AgLVIgJHJ1bnRpbWVfcGF0aC9saWI2NC8qICR7YmluX2Rpcn0vbGliNjQvCiAgICBmaQoKICAgIHJtIC1yZiAke2Jpbl9kaXJ9L2luY2x1ZGUKCiAgICBpZiBbIC1mICR7cm9vdF9kaXJ9LyR7dXBsb2FkX2ZpbGV9IF07IHRoZW4KICAgICAgICBybSAke3Jvb3RfZGlyfS8ke3VwbG9hZF9maWxlfQogICAgZmkKICAgIHRhciBjSmYgJHt1cGxvYWRfZmlsZX0gJHtiaW5fZGlyfQp9CgoKVHJhcENsZWFuKCkgewogICAgaWYgWyAhICRLRUVQIF07IHRoZW4KICAgICAgICBjZCAke3Jvb3RfZGlyfQogICAgICAgIHJtIC1yZiAke2J1aWxkX2Rpcn0gJHtiaW5fZGlyfSAke3dpbmUzMl9hcmNoaXZlfSAke2Rlc3RfZmlsZX0gJHt1cGxvYWRfZmlsZX0KICAgIGZpCiAgICBwcmludGYgIkJ1aWxkIGZhaWxlZCwgY2xlYW5lZCB1cC5cbiIKICAgIGV4aXQKfQoKaWYgWyAkMSBdOyB0aGVuCiAgICAkMQplbHNlCiAgICBCdWlsZAogICAgUGFja2FnZQpmaQ==" > build.sh
        sudo apt-get install -y lxd lxd-client sshpass
        sudo adduser $USER lxd
        newgrp lxd
        id

    - name: Setup lxc containers
      run: |
        cat buildbot/preseed | sudo lxd init --preseed
        sudo lxc launch images:ubuntu/bionic/i386 buildbot-bionic-i386
        sudo lxc launch images:ubuntu/bionic/amd64 buildbot-bionic-amd64

    - name: Add and execute 0-buildbot-usersetup.sh
      run: |
        sudo lxc exec buildbot-bionic-amd64 -- bash -c "echo -e 'ubuntu\nubuntu' | passwd ubuntu && echo 'ubuntu ALL=NOPASSWD: ALL' | EDITOR='tee -a' visudo"
        sudo lxc exec buildbot-bionic-i386 -- bash -c "echo -e 'ubuntu\nubuntu' | passwd ubuntu && echo 'ubuntu ALL=NOPASSWD: ALL' | EDITOR='tee -a' visudo"

    - name: Execute 1-setup-container-networking.sh
      run: |
        sleep 10
        mkdir ~/.ssh/
        touch ~/.ssh/config
        sudo ./1-setup-container-networking.sh buildbot-bionic-i386 buildbot-bionic-amd64
        cat ~/.ssh/config

    - name: Execute setup-container.sh
      working-directory: ./buildbot
      run: |
        ./setup-container.sh buildbot-bionic-i386
        ./setup-container.sh buildbot-bionic-amd64

    - name: Execute ssh-copy-id for buildbot32 and buildbot64
      run: |
        ssh-keygen -q -t rsa -N '' -f ~/.ssh/id_rsa <<<y >/dev/null 2>&1
        sshpass -p "ubuntu" ssh-copy-id -o StrictHostKeyChecking=no ubuntu@buildbot-bionic-i386
        sshpass -p "ubuntu" ssh-copy-id -o StrictHostKeyChecking=no ubuntu@buildbot-bionic-amd64

    - name: Install dependencies
      run: |
        ssh ubuntu@buildbot-bionic-i386 "
          sudo apt install -y dh-autoreconf autoconf bison ccache debhelper desktop-file-utils docbook-to-man \
          docbook-utils docbook-xsl flex fontforge gawk gettext libacl1-dev \
          libasound2-dev libcloog-ppl1 libcups2-dev libdbus-1-dev \
          libgcrypt-dev libgif-dev libglu1-mesa-dev libgsm1-dev libgtk-3-dev \
          liblcms2-dev libldap2-dev libmpg123-dev libncurses5-dev \
          libopenal-dev libosmesa6-dev libpcap-dev libpulse-dev \
          libssl-dev libtiff5-dev libudev-dev libv4l-dev libva-dev libxslt1-dev libxt-dev \
          ocl-icd-opencl-dev prelink valgrind linux-libc-dev libppl14 libcolord2 libvulkan-dev \
          libgnutls28-dev libgstreamer-plugins-base1.0-dev libgstreamer1.0-dev \
          libpng-dev libsdl2-dev libavcodec-dev \
          libavutil-dev libswresample-dev libavcodec58 libswresample3 libavutil56 libfaudio0 libfaudio-dev \
          libvkd3d1 libvkd3d-dev libvkd3d-utils1 libvkd3d-shader1 vkd3d-demos libvulkan1 \
          libgstreamer1.0-0 gstreamer1.0-plugins-base gstreamer1.0-plugins-good gstreamer1.0-plugins-bad \
          gstreamer1.0-plugins-ugly gstreamer1.0-libav gstreamer1.0-doc gstreamer1.0-tools gstreamer1.0-x \
          gstreamer1.0-alsa gstreamer1.0-gl gstreamer1.0-gtk3 gstreamer1.0-qt5 gstreamer1.0-pulseaudio
        "
        ssh ubuntu@buildbot-bionic-amd64 "
          sudo apt install -y dh-autoreconf autoconf bison ccache debhelper desktop-file-utils docbook-to-man \
          docbook-utils docbook-xsl flex fontforge gawk gettext libacl1-dev \
          libasound2-dev libcloog-ppl1 libcups2-dev libdbus-1-dev \
          libgcrypt-dev libgif-dev libglu1-mesa-dev libgsm1-dev libgtk-3-dev \
          liblcms2-dev libldap2-dev libmpg123-dev libncurses5-dev \
          libopenal-dev libosmesa6-dev libpcap-dev libpulse-dev \
          libssl-dev libtiff5-dev libudev-dev libv4l-dev libva-dev libxslt1-dev libxt-dev \
          ocl-icd-opencl-dev prelink valgrind linux-libc-dev libppl14 libcolord2 libvulkan-dev \
          libgnutls28-dev libgstreamer-plugins-base1.0-dev libgstreamer1.0-dev \
          libpng-dev libsdl2-dev libavcodec-dev \
          libavutil-dev libswresample-dev libavcodec58 libswresample3 libavutil56 libfaudio0 libfaudio-dev \
          libvkd3d1 libvkd3d-dev libvkd3d-utils1 libvkd3d-shader1 vkd3d-demos libvulkan1 \
          libgstreamer1.0-0 gstreamer1.0-plugins-base gstreamer1.0-plugins-good gstreamer1.0-plugins-bad \
          gstreamer1.0-plugins-ugly gstreamer1.0-libav gstreamer1.0-doc gstreamer1.0-tools gstreamer1.0-x \
          gstreamer1.0-alsa gstreamer1.0-gl gstreamer1.0-gtk3 gstreamer1.0-qt5 gstreamer1.0-pulseaudio
        "

    - name: Push Wine,Staging and patches files
      run: |
        ssh ubuntu@buildbot-bionic-i386 "rm -r ~/buildbot/runners/wine/patches/"
        ssh ubuntu@buildbot-bionic-amd64 "rm -r ~/buildbot/runners/wine/patches/"
        ssh ubuntu@buildbot-bionic-i386 "cd buildbot/runners/wine && git clone -b wine-${{ env.RELEASE_VERSION }} git://source.winehq.org/git/wine.git"
        ssh ubuntu@buildbot-bionic-amd64 "cd buildbot/runners/wine && git clone -b wine-${{ env.RELEASE_VERSION }} git://source.winehq.org/git/wine.git"
        ssh ubuntu@buildbot-bionic-i386 "cd buildbot/runners/wine && git clone -b v${{ env.RELEASE_VERSION }} https://github.com/wine-staging/wine-staging.git"
        ssh ubuntu@buildbot-bionic-amd64 "cd buildbot/runners/wine && git clone -b v${{ env.RELEASE_VERSION }} https://github.com/wine-staging/wine-staging.git"
        scp -r patches ubuntu@buildbot-bionic-i386:~/buildbot/runners/wine/
        scp -r patches ubuntu@buildbot-bionic-amd64:~/buildbot/runners/wine/
        scp build.sh ubuntu@buildbot-bionic-i386:~/buildbot/runners/wine/
        scp build.sh ubuntu@buildbot-bionic-amd64:~/buildbot/runners/wine/

    - name: Execute buildbot32-sshsetup
      run: |
        ssh ubuntu@buildbot-bionic-i386 'sudo chown -R ubuntu:ubuntu ~/.ssh/config'
        ssh ubuntu@buildbot-bionic-i386 "ssh-keygen -q -t rsa -N '' -f ~/.ssh/id_rsa <<<y >/dev/null 2>&1"
        ssh ubuntu@buildbot-bionic-i386 'sshpass -p "ubuntu" ssh-copy-id -o StrictHostKeyChecking=no ubuntu@buildbot64'
          
    - name: Execute buildbot64-sshsetup
      run: |
        ssh ubuntu@buildbot-bionic-amd64 'sudo chown -R ubuntu:ubuntu ~/.ssh/config'
        ssh ubuntu@buildbot-bionic-amd64 "ssh-keygen -q -t rsa -N '' -f ~/.ssh/id_rsa <<<y >/dev/null 2>&1"
        ssh ubuntu@buildbot-bionic-amd64 'sshpass -p "ubuntu" ssh-copy-id -o StrictHostKeyChecking=no ubuntu@buildbot32'

    - name: Apply patches
      run: |
        ssh ubuntu@buildbot-bionic-i386 "cd buildbot/runners/wine/ && bash patches/protonprep.sh"
        ssh ubuntu@buildbot-bionic-amd64 "cd buildbot/runners/wine/ && bash patches/protonprep.sh"

    - name: Build Wine GE
      run: |
        ssh ubuntu@buildbot-bionic-i386 "cd buildbot/runners/wine && mv wine wine-src"
        ssh ubuntu@buildbot-bionic-amd64 "cd buildbot/runners/wine && mv wine wine-src"
        ssh ubuntu@buildbot-bionic-amd64 "cd buildbot/runners/wine && ./build.sh --as lutris --version ${{ env.RELEASE_VERSION }} --usemingw --keep"
  
    - name: Move Archive
      run: |
        ssh ubuntu@buildbot-bionic-amd64 "cd buildbot/runners/wine"
        ssh ubuntu@buildbot-bionic-amd64 "mv buildbot/runners/wine/wine-*.tar.xz ~/"
        ssh ubuntu@buildbot-bionic-amd64 "cd ~/"
        scp ubuntu@buildbot-bionic-amd64:~/wine-*.tar.xz ${{ GITHUB.WORKSPACE }}
        mv wine-lutris-${{ env.RELEASE_VERSION }}-x86_64.tar.xz wine-lutris-ge-${{ env.RELEASE_VERSION }}-x86_64.tar.xz

    - name: Upload a Build Artifact
      uses: actions/upload-artifact@v3.1.0
      with:
        path: "wine-lutris-ge-${{ env.RELEASE_VERSION }}-x86_64.tar.xz"
